<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>JDemetra+ documentation - Calendar correction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./A-benchmarking.html" rel="next">
<link href="./A-outlier-detection.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./P_Algorithms.html">Algorithms</a></li><li class="breadcrumb-item"><a href="./A-calendar-correction.html">Calendar correction</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">JDemetra+ documentation</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/annasmyk/JD_Quarto_Book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is JDemetra+?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./G-how-to-use-this-book.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to use this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./G-news-v3-vs-v2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">New Features in v 3.x family</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./P_Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Algorithms</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-RegArima-Tramo-Modelling-Overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Adjustment (SA) Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-pre-treatment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA: Pre-Treatment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-X11-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA: X11 Decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-seats-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA: Seats Decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-rev-policies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA: Revision policies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-hf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA of high-frequency data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-x12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA: X12+ and MX12+</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-stl-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA: STL+ and MSTL+</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sa-bsm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SA: STS and MSTS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-outlier-detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outlier detection and external regressors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-calendar-correction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Calendar correction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-benchmarking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Benchmarking and temporal disagreggation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-trend-cycle-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Trend-cycle estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-revision-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Revision Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-nowcasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nowcasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./P_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tools</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-GUI-Overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graphical User Interface (GUI): Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-GUI-Data-Viz-TS-Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GUI: data visualization and time series tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-GUI-SA-Modelling-Features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GUI: SA and Modelling Features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-GUI-Output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GUI: Generating output</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-plug-ins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plug-ins (GUI extensions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-Production-tools-cruncher-QR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cruncher and quality report</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T-r-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R packages</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./P_Methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Methods</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-spectral-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spectral Analysis Principles and Tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-reg-arima-modelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reg-ARIMA models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-X11-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">X11 decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-SEATS-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seats decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-STL-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">STL: Local regression decomposition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-Temp-Disagg-Bench.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Benchmarking and Temporal disaggregation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./M-revision-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Revision Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Output_Description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Output description</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#in-this-chapter" id="toc-in-this-chapter" class="nav-link active" data-scroll-target="#in-this-chapter">In this Chapter</a></li>
  <li><a href="#rationale-for-calendar-correction" id="toc-rationale-for-calendar-correction" class="nav-link" data-scroll-target="#rationale-for-calendar-correction">Rationale for Calendar correction</a></li>
  <li><a href="#modelling-calendar-effects" id="toc-modelling-calendar-effects" class="nav-link" data-scroll-target="#modelling-calendar-effects">Modelling calendar effects</a>
  <ul class="collapse">
  <li><a href="#regression-model-for-type-of-days" id="toc-regression-model-for-type-of-days" class="nav-link" data-scroll-target="#regression-model-for-type-of-days">Regression Model for type of days</a></li>
  <li><a href="#correction-for-deterministic-seasonality" id="toc-correction-for-deterministic-seasonality" class="nav-link" data-scroll-target="#correction-for-deterministic-seasonality">Correction for deterministic seasonality</a></li>
  <li><a href="#weights-for-different-groups-of-days" id="toc-weights-for-different-groups-of-days" class="nav-link" data-scroll-target="#weights-for-different-groups-of-days">Weights for different groups of days</a></li>
  <li><a href="#use-in-reg-arima-models" id="toc-use-in-reg-arima-models" class="nav-link" data-scroll-target="#use-in-reg-arima-models">Use in Reg-ARIMA models</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#easter-effect" id="toc-easter-effect" class="nav-link" data-scroll-target="#easter-effect">Easter effect</a></li>
  <li><a href="#stock-series" id="toc-stock-series" class="nav-link" data-scroll-target="#stock-series">Stock series</a></li>
  </ul></li>
  <li><a href="#usr_def_cal" id="toc-usr_def_cal" class="nav-link" data-scroll-target="#usr_def_cal">Generating Regressors for calendar correction</a>
  <ul class="collapse">
  <li><a href="#in-gui" id="toc-in-gui" class="nav-link" data-scroll-target="#in-gui">In GUI</a></li>
  <li><a href="#in-r-with-rjd3toolkit" id="toc-in-r-with-rjd3toolkit" class="nav-link" data-scroll-target="#in-r-with-rjd3toolkit">In R with rjd3toolkit</a></li>
  </ul></li>
  <li><a href="#test-for-residual-calendar-effects" id="toc-test-for-residual-calendar-effects" class="nav-link" data-scroll-target="#test-for-residual-calendar-effects">Test for Residual Calendar effects</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/annasmyk/JD_Quarto_Book/edit/main/A-calendar-correction.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/annasmyk/JD_Quarto_Book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="a-cal" class="quarto-section-identifier">Calendar correction</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="in-this-chapter" class="level2">
<h2 class="anchored" data-anchor-id="in-this-chapter">In this Chapter</h2>
<p>This chapter is divided in two parts. The first one (theory) outlines the rationale for calendar correction and the underlying modelling. The second part (practice) describes how relevant regressors for calendar correction are built in JDemetra+.</p>
<p>As calendar effects are deterministic, they can be corrected with a regression model. In the algorithms X-13-ARIMA and Tramo-Seats it boils down to adding suitable regressors to the <a href="A-sa-pre-treatment.html">pre-treatment phase</a>). This chapter will describe how to generate a set of regressors corresponding to the desired correction, which will happen according to the following steps:</p>
<ul>
<li><p>step 1: generate a calendar (usually national calendar of interest). If this step is skipped a default calendar, not taking into account country-specific holidays will be used.</p></li>
<li><p>step 2: generate regressors based on the above defined calendar</p></li>
</ul>
<p>Regressors will have the same frequency as the raw data, thus an aggregation process will be defined unless the data is daily.</p>
<ul>
<li>step 2b: a specific variable for modelling the easter effect (or any other moving holiday effect like ramadan) can also be defined</li>
</ul>
<p>Most of the functions are designed for quarterly and monthly data. What applies to daily and weekly data will be highlighted.</p>
<p>Regressors are corrected for deterministic seasonality through a long-term mean correction</p>
<ul>
<li>step 3: these regressors have to be plugged-in in pre-adjustment phase of a seasonal adjustment estimation. How to do this is detailed in chapters on <a href="A-sa-pre-treatment.html">pre-treatment</a> and <a href="A-sa-hf.html">SA of High-Frenquency data</a>.</li>
</ul>
<p>How to generate other types of regressors is described <a href="A-outlier-detection.html">here</a> and how to plug them into Reg-ARIMA models is detailed <a href="A-sa-pre-treatment.html">here</a></p>
<!-- ## Tools Map -->
<!-- up coming content -->
</section>
<section id="rationale-for-calendar-correction" class="level2">
<h2 class="anchored" data-anchor-id="rationale-for-calendar-correction">Rationale for Calendar correction</h2>
<p>A calendar is heterogeneous, it at least composed of:</p>
<ul>
<li><p>trading days: days usually worked, taking into account the company’s sector. (Most frequently Mondays through Fridays when not bank holidays).</p></li>
<li><p>week-ends</p></li>
<li><p>bank holidays</p></li>
</ul>
<p>For a given year as well as throughout the years, every month doesn’t have the same number of days per day-type, which implies that all months/quarters aren’t “equal”, even for a given type of month or quarter. This causes <strong>calendar effects</strong> which have to be removed to allow sounder comparisons following the same principle as seasonality correction.</p>
<p>Two types of effects result from this heterogeneity:</p>
<ul>
<li><p>length of period (month/quarter) (leap-year or direct correction)</p></li>
<li><p>composition of period (type of day)</p></li>
</ul>
<p>This second effect is also relevant for daily (and weekly) data.</p>
<p>An additional easter effect can be modelled, as for some series, variations linked to Easter can be seen over a few days prior or following Easter. For example, flowers and chocolate sales might rise significantly as Easter approaches. (in practice this effect is very rare, it is better to deactivate by default detection)</p>
</section>
<section id="modelling-calendar-effects" class="level2">
<h2 class="anchored" data-anchor-id="modelling-calendar-effects">Modelling calendar effects</h2>
<section id="regression-model-for-type-of-days" class="level3">
<h3 class="anchored" data-anchor-id="regression-model-for-type-of-days">Regression Model for type of days</h3>
<p>For each period <span class="math inline">\(t\)</span>, the days are divided in <span class="math inline">\(K\)</span> groups <span class="math inline">\(\lbrace{D_{t1},\dots, D_{tK}\rbrace}\)</span>.</p>
<p>The groups of days can be anything (trading days, working days, Sundays + holidays assimilated to Sundays…) ADD</p>
<p>We write <span class="math inline">\(N_t=\sum_1^K{D_{ti}}\)</span>, the number of days of the period <span class="math inline">\(t\)</span></p>
<p>Two terms appear:</p>
<ul>
<li><p>the specific effect of a type of day <span class="math inline">\(i\)</span> as a contrast between the number of days <span class="math inline">\(i\)</span> and the number of Sundays and bank holidays</p></li>
<li><p>the effect of the month’s (or period’s) length.</p></li>
</ul>
<p>Once seasonally adjusted, this term comes down to the leap year effect:</p>
<ul>
<li>for all months except Februaries <span class="math inline">\(\bar{N}_t = N_t\)</span></li>
<li>for Februaries <span class="math inline">\(\bar{N}_t=28.25\)</span> and <span class="math inline">\(N_{t}=28\)</span> or <span class="math inline">\(N_{t}=29\)</span></li>
</ul>
<p>The effect of one day of the group <span class="math inline">\(i\)</span> is measured by <span class="math inline">\(\alpha_i\)</span>, so that the global effect of the group <span class="math inline">\(i\)</span> for the period <span class="math inline">\(t\)</span> is <span class="math inline">\(\alpha_i D_{ti}\)</span></p>
<p>The global effect of all the days for the period <span class="math inline">\(t\)</span> is</p>
<p><span class="math display">\[
\sum_{i=1}^K{\alpha_i D_{ti}} = \bar\alpha N_t + \sum_{i=1}^K{(\alpha_i-\bar\alpha) D_{ti}}
\]</span></p>
<p>where <span class="math inline">\(\bar\alpha=\sum_{i=1}^K{w_i \alpha_i}\)</span> with <span class="math inline">\(\sum_{i=1}^Kw_i=1\)</span></p>
<p>So,</p>
<p><span class="math display">\[
\sum_{i=1}^K{(\alpha_i-\bar\alpha) w_i} = \sum_{i=1}^K{\alpha_iw_i}-\bar\alpha\sum_{i=1}^K w_i=0
\]</span></p>
<p>LEAP YEAR part to comment</p>
<p>We focus now on <span class="math inline">\(\sum_{i=1}^K{(\alpha_i-\bar\alpha) D_{ti}}\)</span>, the actual trading days effects (excluding the length of period effect).</p>
<p>Writing <span class="math inline">\(\alpha_i-\bar\alpha = \beta_i\)</span> and using that <span class="math inline">\(\sum_{i=1}^K{\beta_i w_i} = 0\)</span>, we have that</p>
<p><span class="math display">\[
\sum_{i=1}^K{\beta_i D_{ti}}=\sum_{i=1}^K{\beta_i(D_{ti} - \frac{w_i}{w_K}}D_{tK})= \sum_{i=1}^{K-1}{\beta_i(D_{ti} - \frac{w_i}{w_K}}D_{tK})
\]</span></p>
<p>Note that the relationship is valid for any set of weights <span class="math inline">\(w_i\)</span>. It is also clear that the contrasting group of days can be any group:</p>
<p><span class="math display">\[
\sum_{i=1}^{K-1}{\beta_i(D_{ti} - \frac{w_i}{w_K}}D_{tK}) = \sum_{i=1}^{K, i \neq J}{\beta_i(D_{ti} - \frac{w_i}{w_J}}D_{tJ})
\]</span></p>
<p>The “missing” coefficient is easily derived from the others:</p>
<p><span class="math display">\[
\beta_K = -\frac{1}{w_K}\sum_{i=1}^{K-1}{\beta_i w_i}
\]</span></p>
</section>
<section id="correction-for-deterministic-seasonality" class="level3">
<h3 class="anchored" data-anchor-id="correction-for-deterministic-seasonality">Correction for deterministic seasonality</h3>
<p>In the case of seasonal adjustment, we further impose that the regression variables don’t contain deterministic seasonality. That is achieved by removing from each type of period (month, quarter…) its long term average. We write <span class="math inline">\(\bar{D_i^y}\)</span> the long term average of the yearly number of days in the group <span class="math inline">\(i\)</span> and <span class="math inline">\(\bar{D_{i,J}^y}\)</span> the long term average of the number of days in the group <span class="math inline">\(i\)</span> for the periods <span class="math inline">\(J\)</span> (for instance, average number of Mondays in January…).</p>
<p>The corrected contrast for the time t belonging to the period J is:</p>
<p><span class="math display">\[
C_{ti}=D_{ti}-\bar{D_{i, J}^y}-\frac{w_i}{w_K}(D_{tK}- \bar{D_{K, J}^y})
\]</span></p>
<p>How is the long term mean computed? Probabilistic approach (more on this soon)</p>
</section>
<section id="weights-for-different-groups-of-days" class="level3">
<h3 class="anchored" data-anchor-id="weights-for-different-groups-of-days">Weights for different groups of days</h3>
<p>We can define different sets of weights. The usual one consists in giving the same weight to each type of days. <span class="math inline">\(w_i\)</span> is just proportional to the number of days in the group <span class="math inline">\(i\)</span>. In the case of “week days”, <span class="math inline">\(w_0 = \frac{5}{7}\)</span> (weeks) and <span class="math inline">\(w_1=\frac{2}{7}\)</span> (week-ends). In the case of “trading days”, <span class="math inline">\(w_i=\frac{1}{7}\)</span> … Another approach consists in using the long term yearly averages, taking into account the actual holidays. We get now that <span class="math inline">\(w_i=\frac{\bar{D_i^y}}{365.25}\)</span>.</p>
<p>After the removal of the deterministic seasonality, the variables computed using the two sets of weights considered above are very similar. In the case of the “trading days”, the difference for the time <span class="math inline">\(t\)</span>, belonging to the period <span class="math inline">\(J\)</span>, and for the day <span class="math inline">\(i\)</span> with contrast <span class="math inline">\(K\)</span> is <span class="math inline">\((1-\frac{w_i}{w_K})(D_{tK}- \bar{D_{K, J}^y})\)</span>, which is usually small. By default, JD+ uses the first approach, which is simpler. The second approach is implemented in the algorithmic modules, but not available through the graphical interface.</p>
</section>
<section id="use-in-reg-arima-models" class="level3">
<h3 class="anchored" data-anchor-id="use-in-reg-arima-models">Use in Reg-ARIMA models</h3>
<p>In the context of Reg-ARIMA modelling, we can also observe that the global effect of the trading days doesn’t depend neither on the used weights (we project on the same space) nor on the contrasting group (see above) nor on the long term corrections (removed by differencing).</p>
<p>The estimated coefficients slightly change if we use different weights (not if we use a different contrasting group). It must also be noted that the choices affect the T-Stat of the different coefficients (not the joint F-Test), which can lead to other solutions when those T-Stats are used for selecting the regression variables (Tramo). Considering that the leap year/length of period variable is nearly independent of the other variables, the test on that variable is not very sensitive to the various specifications.</p>
</section>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation">Interpretation</h3>
<p>The use of different specifications of the trading days doesn’t impact the final results (except through some automatic selection procedure). It just (slightly) changes the way we interpret the estimated coefficients.</p>
</section>
<section id="easter-effect" class="level3">
<h3 class="anchored" data-anchor-id="easter-effect">Easter effect</h3>
</section>
<section id="stock-series" class="level3">
<h3 class="anchored" data-anchor-id="stock-series">Stock series</h3>
</section>
</section>
<section id="usr_def_cal" class="level2">
<h2 class="anchored" data-anchor-id="usr_def_cal">Generating Regressors for calendar correction</h2>
<p>The following parts details how to build customized regressors for calendar correction using</p>
<ul>
<li><p>graphical user interface (GUI)</p></li>
<li><p>rjd3toolkit package.</p></li>
</ul>
<p>To take specific holidays into account a calendar has to be defined, regressors will be built subsequently.</p>
<p>As regressors have the same data frequency as the input series, several cases:</p>
<ul>
<li><p>for daily series : regressors are dummies representing each holidays</p></li>
<li><p>for weekly, monthly and quarterly series regressors are aggregated indicators, the way of grouping different types of days and holidays has to be specified.</p></li>
</ul>
<section id="in-gui" class="level3">
<h3 class="anchored" data-anchor-id="in-gui">In GUI</h3>
<section id="usr-def-cal" class="level4">
<h4 class="anchored" data-anchor-id="usr-def-cal">Creating calendars</h4>
<p>The customized calendar can be directly linked to the calendar correction option in GUI while specifying a seasonal adjustment process. See chapters on <a href="A-sa.qmd">SA</a> or <a href="./A-sa-hf.html">SA of HF data</a>.</p>
<section id="default-calendar" class="level5">
<h5 class="anchored" data-anchor-id="default-calendar">Default Calendar</h5>
<p>In the graphical user interface, calendars in are stored in the <em>Workspace</em> window in the <em>Utilities</em> section. In the default calendar, country-specific national holidays are not taken into account, it reflects only the usual composition of the weeks in the calendar periods.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image1.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>To view the details of the default calendar: double click on it</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image2.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
</section>
<section id="set-properties" class="level5">
<h5 class="anchored" data-anchor-id="set-properties">Set Properties</h5>
<p>In the <em>Properties</em> panel the user can set:</p>
<ul>
<li><p>Frequency (monthly, quarterly..)</p></li>
<li><p>Trading days or working days regressors</p></li>
</ul>
<p><em>Trading days</em>: 6 contrast variables</p>
<p>number of Mondays - number of Sundays</p>
<p>and one regressor for the leap year effect.</p>
<p><em>Working Days</em>: 1 contrast variable (<span class="math inline">\(number\ of\ working days (monday to friday) - number\ of\ Saturdays and Sundays\)</span>,…) and one regressor for the leap year effect.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image3.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p><strong>Modification of the initial settings for the Default calendar</strong></p>
</section>
<section id="spectrum-visualization" class="level5">
<h5 class="anchored" data-anchor-id="spectrum-visualization">Spectrum visualization</h5>
<p>The top-right panel displays the spectrum for the given calendar variable. By default, the first variable from the table is shown.</p>
<ul>
<li>To change it, click on the calendar variable header.</li>
</ul>
<p>Calendar variables shouldn’t have a peak neither at a zero frequency (trend) nor the seasonal frequencies.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image6.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
</section>
</section>
<section id="modify-an-existing-calendar" class="level4">
<h4 class="anchored" data-anchor-id="modify-an-existing-calendar">Modify an existing Calendar</h4>
<ul>
<li><p>click the option <em>Edit</em> from the context menu</p></li>
<li><p>the list of holidays defined for this calendar is displayed</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image12.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Edit a calendar window</strong></figcaption>
</figure>
</div>
<ul>
<li><p>To add a holiday unfold the <strong>+</strong> menu</p></li>
<li><p>To remove a holiday click on it and choose the <strong>-</strong> button</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image13.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Removing a holiday from the calendar</strong></figcaption>
</figure>
</div>
<section id="creating-a-new-calendar" class="level5">
<h5 class="anchored" data-anchor-id="creating-a-new-calendar">Creating a new calendar</h5>
<p>An appropriate calendar, containing the required national holidays, needs to be created to adjust a series for country-specific calendar effects.</p>
<ul>
<li>right click on the <em>Calendar</em> item from the <em>Workspace</em> window and choose <strong>Add</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image14.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>Three options are available:</p>
<ul>
<li><p><em>National calendars</em>: allows to include country-specific holidays</p></li>
<li><p><em>Composite calendars</em> : creates calendar as a weighted sum of several national calendars</p></li>
<li><p><em>Chained calendars</em> : allows to chain two national calendars before and after a break</p></li>
</ul>
</section>
<section id="national-calendar" class="level5">
<h5 class="anchored" data-anchor-id="national-calendar">National Calendar</h5>
<p>To define a national calendar: right click on Calendar item in the Utility panel of the workspace window</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image14.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<ul>
<li><p>To add a holiday unfold the <strong>+</strong> menu</p></li>
<li><p>To remove a holiday from the list click on it and choose the <strong>-</strong> button.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image15.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>Four options are available here:</p>
<pre><code>- **Fixed** : holiday occurring at the same date

- **Easter Related**: holiday that depends on Easter Sunday date

- **Fixed Week**: fixed holiday that always falls in a specific week of a given month

- **Special Day**:  choose a holiday from a list of pre-defined holidays (link to table)</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image16.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<ul>
<li>to use Julian Easter</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image17.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>To add a holiday from this list to the national calendar, choose the <em>Special day</em> item from the <em>Special days</em> list.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image18.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Adding a pre-defined holiday to the calendar</strong></figcaption>
</figure>
</div>
<p>By default, when the <em>Special Days</em> option is selected, JDemetra+ always adds <em>Christmas</em> to the list of selected holidays. The user can change this initial choice by specifying the settings in the panel on the right and clicking <em>OK</em>. The settings that can be changed include:</p>
<ul>
<li><p><strong>Start</strong>: starting date for the holiday (expecting <em>yyyy-mm-dd</em>) Default is the starting date of the calendar (empty cell).</p></li>
<li><p><strong>End</strong>: same as start</p></li>
<li><p><strong>Weight</strong> : specifies the impact of the holiday on the series. The default weight is 1 (full weight) assuming that the influence of the holiday is the same as a regular Sunday. If less the a value between 0 and 1 can be assigned.</p></li>
<li><p><strong>Day event</strong>: a list of pre-defined holidays (link to table)</p></li>
<li><p><strong>Offset</strong>: allows to set a holiday as related to a pre-specified holiday by specifying the distance in days (e.g Easter Sunday). Default offset is 1. It can be positive or negative. Positive offset: defines a holiday following the pre-specified holiday. Negative offset: defines a holiday preceding the selected pre-specified.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image19.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Choosing a pre-defined holiday from the list</strong></figcaption>
</figure>
</div></li>
<li><p>To define a fixed holiday not included in the list of pre-defined holidays:</p>
<ul>
<li>choose <em>Fixed</em> from the <em>Special days</em> list: by default January, 1 is displayed. Specify the settings:</li>
</ul></li>
<li><p><strong>Start</strong>: starting date for the holiday (expecting <em>yyyy-mm-dd</em>) Default is the starting date of the calendar (empty cell).</p></li>
<li><p><strong>End</strong>: same as start</p></li>
<li><p><strong>Weight</strong> : specifies the impact of the holiday on the series. The default weight is 1 (full weight) assuming that the influence of the holiday is the same as a regular Sunday. If less the a value between 0 and 1 can be assigned.</p></li>
<li><p><strong>Day</strong>: day of month when the fixed holiday is celebrated.</p></li>
<li><p><strong>Month</strong>: month, in which the fixed holiday is celebrated.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image20.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Options for a fixed holiday</strong></figcaption>
</figure>
</div>
<ul>
<li><p>Add <em>Corpus Christi</em>: example of an Easter related holiday not included in the special day list(link to table). It is is a moving holiday celebrated 60 days after Easter</p>
<ul>
<li>choose the <em>Easter related</em> item from the <em>Special days</em> list.</li>
</ul>
<p><img src="All_images/UG_CAL_image22.jpg" class="img-fluid" alt="Text"> By default <em>Easter + 1</em> is displayed. Setting can be changed :</p></li>
<li><p><strong>Start</strong>: starting date for the holiday (expecting <em>yyyy-mm-dd</em>) Default is the starting date of the calendar (empty cell).</p></li>
<li><p><strong>End</strong>: same as start</p></li>
<li><p><strong>Weight</strong> : specifies the impact of the holiday on the series. The default weight is 1 (full weight) assuming that the influence of the holiday is the same as a regular Sunday. If less the a value between 0 and 1 can be assigned.</p></li>
<li><p><strong>Offset</strong>: To define Corpus Christi enter <strong>60</strong>, as it is celebrated 60 days after Easter Sunday.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image23.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<ul>
<li><p>Fixed week option: when dealing with holidays occurring on the same week of a given month. Example: Labour Day in the USA and Canada, celebrated on the first Monday of September in Canada</p>
<ul>
<li>choose <em>Fixed Week</em> from the <em>Special days</em> list.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image24.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div></li>
</ul>
<p>Available settings are:</p>
<ul>
<li><p><strong>Start</strong>: starting date for the holiday (expecting <em>yyyy-mm-dd</em>) Default is the starting date of the calendar (empty cell).</p></li>
<li><p><strong>End</strong>: same as start</p></li>
<li><p><strong>Weight</strong> : specifies the impact of the holiday on the series. The default weight is 1 (full weight) assuming that the influence of the holiday is the same as a regular Sunday. If less the a value between 0 and 1 can be assigned</p></li>
<li><p><strong>Day of Week</strong>: day of week when the holiday is celebrated each year</p></li>
<li><p><strong>Month</strong>: month, in which the holiday is celebrated each year</p></li>
<li><p><strong>Week</strong>: number denoting the place of the week in the month: between 1 and 5</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image25.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>The list of the holidays should contain only unique entries. Otherwise, a warning, as shown in the picture below, will be displayed.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image26.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>A calendar without a name cannot be saved. Fill the <em>Name</em> box before saving the calendar.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image27.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>Example : final view of a properly defined calendar for Poland</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image28.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>The calendar is visible in the <em>Workspace</em> window</p>
<ul>
<li>To display the available options right-click on it</li>
</ul>
<p>A national calendar can be edited, duplicated (to create another calendar) and/or analysed (double click to display it in the panel on the right) or deleted.</p>
</section>
<section id="chained-calendar" class="level5">
<h5 class="anchored" data-anchor-id="chained-calendar">Chained Calendar</h5>
<p>Creating a chained calendar is relevant when a major break occurs in the definition of the country-specific holidays.</p>
<p>First define the 2 (or <span class="math inline">\(N\)</span>) national calendars corresponding to each regime as explained in the section above.</p>
<p>To define a chained calendar: right click on Calendar item in the Utility panel of the workspace window</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image14.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<p>In the <em>Properties</em> panel specify:</p>
<ul>
<li><p>first and the second calendar</p></li>
<li><p>break date</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image32.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
</section>
<section id="composite-calendar" class="level5">
<h5 class="anchored" data-anchor-id="composite-calendar">Composite Calendar</h5>
<p>Creating a composite calendar is relevant when correcting series which include data from more than one country/region. This option can be used, for example, to create the calendar for the European Union or to create the national calendar for a country, in which regional holidays are celebrated.</p>
<p>First define the relevant national calendars corresponding to each member state/region as explained above.</p>
<p>To define a chained calendar: right click on Calendar item in the Utility panel of the workspace window</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image34.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
<ul>
<li><p>Fill the name box</p></li>
<li><p>Mark the regional calendars to be used</p></li>
<li><p>Assign a weight to each calendar.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image35.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Text</figcaption>
</figure>
</div>
</section>
<section id="importing-an-existing-calendar-from-a-file" class="level5">
<h5 class="anchored" data-anchor-id="importing-an-existing-calendar-from-a-file">Importing an existing calendar from a file</h5>
<p>Right click on the <em>Calendar</em> item from the <em>Workspace</em> window and choose the <em>Import</em> item from the menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image8.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Importing a calendar to JDemetra+</strong></figcaption>
</figure>
</div>
<ul>
<li>choose the appropriate file and open it</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image10.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Choosing the file</strong></figcaption>
</figure>
</div>
<p>JDemetra+ adds it to the calendars list</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="All_images/UG_CAL_image11.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>A list of calendars with a newly imported calendar</strong></figcaption>
</figure>
</div>
</section>
<section id="example-of-a-calendar-file" class="level5">
<h5 class="anchored" data-anchor-id="example-of-a-calendar-file">Example of a calendar file</h5>
<p><img src="All_images/UG_CAL_image9.jpg" class="img-fluid" alt="Example of an .xml file containing a calendar"> #### Generating regressors</p>
</section>
<section id="type-of-days" class="level5">
<h5 class="anchored" data-anchor-id="type-of-days">Type of days</h5>
</section>
<section id="leap-year" class="level5">
<h5 class="anchored" data-anchor-id="leap-year">Leap year</h5>
</section>
<section id="length-of-period" class="level5">
<h5 class="anchored" data-anchor-id="length-of-period">Length of Period</h5>
<p>(adjust param)</p>
</section>
<section id="easter" class="level5">
<h5 class="anchored" data-anchor-id="easter">Easter</h5>
</section>
<section id="stock-td" class="level5">
<h5 class="anchored" data-anchor-id="stock-td">stock TD</h5>
</section>
</section>
</section>
<section id="in-r-with-rjd3toolkit" class="level3">
<h3 class="anchored" data-anchor-id="in-r-with-rjd3toolkit">In R with rjd3toolkit</h3>
<p>Version 3 of JDemetra+ allows to build calendar regressors using the <code>rjd3toolkit</code> package.</p>
<p>The underlying concepts are identical to those available in the graphical user interface (GUI) as described above. R functions replicate the same process and all arguments and outputs are detailed in <code>rjd3toolkit</code> help pages. The sections below provide basic examples.</p>
<p>Note that, RJDemetra package based on version 2 of JDemetra+, doesn’t allow to build calendars and generate regressors. Thus, two approaches are possible when using version 2</p>
<ul>
<li><p>use built in regressors (“working days” or “trading days”) not taking into account national holidays</p></li>
<li><p>import user defined calendar regressors</p></li>
</ul>
<section id="creating-calendars" class="level4">
<h4 class="anchored" data-anchor-id="creating-calendars">Creating calendars</h4>
<section id="national-calendar-1" class="level5">
<h5 class="anchored" data-anchor-id="national-calendar-1">National Calendar</h5>
<p>Creating a national calendar with rjd3toolkit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## French calendar</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>frenchCalendar <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="at">days =</span> <span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">14</span>), <span class="co"># Bastille Day</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixed_day</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="at">validity =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="st">"1982-05-08"</span>)), <span class="co"># End of 2nd WW</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"CHRISTMAS"</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"MAYDAY"</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"EASTERMONDAY"</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASCENSION"</span>), <span class="co">#</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"WHITMONDAY"</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASSUMPTION"</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ALLSAINTSDAY"</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ARMISTICE"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Holidays can be created with the following ways:</p>
<ul>
<li>as fixed days (falling on the exact same date every year)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>day <span class="ot">&lt;-</span> <span class="fu">fixed_day</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="dv">12</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">day =</span> <span class="dv">25</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="fl">0.9</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">validity =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="st">"1968-02-01"</span>, <span class="at">end =</span> <span class="st">"2010-01-01"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>day <span class="co"># December 25th, with weight=0.9, from February 1968 until January 2010</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>as special days, when on the list of common holidays, which is available in the function’s halp page.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the list</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>?special_day</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># To define a holiday for the day after Christmas, with validity and weight</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">special_day</span>(<span class="st">"CHRISTMAS"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">offset =</span> <span class="dv">1</span>, <span class="at">weight =</span> <span class="fl">0.8</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">validity =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="st">"2000-01-01"</span>, <span class="at">end =</span> <span class="st">"2020-12-01"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>as a fixed week day</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixed_week_day</span>(<span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="co"># second Wednesday of July</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>as an easter related holiday</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">easter_day</span>(<span class="dv">1</span>) <span class="co"># Easter Monday</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">easter_day</span>(<span class="sc">-</span><span class="dv">2</span>) <span class="co"># Good Friday</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An example of calendar bringing together all options</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>MyCalendar <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="fu">list</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">21</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"CHRISTMAS"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixed_week_day</span>(<span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="co"># second Wednesday of July</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"MAYDAY"</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">easter_day</span>(<span class="dv">1</span>), <span class="co"># Easter Monday</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">easter_day</span>(<span class="sc">-</span><span class="dv">2</span>), <span class="co"># Good Friday</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixed_day</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="at">validity =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="st">"1982-05-08"</span>)), <span class="co"># End of 2nd WW</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">single_day</span>(<span class="st">"2001-09-11"</span>), <span class="co"># appearing once</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASCENSION"</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">easter_day</span>( <span class="co"># Corpus Christi</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">offset =</span> <span class="dv">60</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">julian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">weight =</span> <span class="fl">0.5</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">validity =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="st">"2000-01-01"</span>, <span class="at">end =</span> <span class="st">"2020-12-01"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"WHITMONDAY"</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASSUMPTION"</span>),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ALLSAINTSDAY"</span>),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ARMISTICE"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For any defined calendar, it is possible to retrieve the long term-mean correction values which would be applied on a given set of regressors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Long-term means of a calendar</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>BE <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="fu">list</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">21</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"CHRISTMAS"</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"MAYDAY"</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"EASTERMONDAY"</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASCENSION"</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"WHITMONDAY"</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASSUMPTION"</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ALLSAINTSDAY"</span>),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ARMISTICE"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(BE)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> <span class="fu">long_term_mean</span>(BE, <span class="dv">12</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">groups =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">holiday =</span> <span class="dv">7</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="chained-calendar-1" class="level5">
<h5 class="anchored" data-anchor-id="chained-calendar-1">Chained Calendar</h5>
<p>Creating a chained calendar is relevant when a major break occurs in the definition of the country-specific holidays.</p>
<p>First define the 2 (or <span class="math inline">\(N\)</span>) national calendars corresponding to each regime as explained in the section above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Belgium <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="fu">list</span>(<span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>), <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">21</span>)))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>France <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="fu">list</span>(<span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>), <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">14</span>)))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>chained_cal <span class="ot">&lt;-</span> <span class="fu">chained_calendar</span>(France, Belgium, <span class="st">"2000-01-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="composite-calendar-1" class="level5">
<h5 class="anchored" data-anchor-id="composite-calendar-1">Composite Calendar</h5>
<p>Creating a composite calendar is relevant when correcting series which include data from more than one country/region. This option can be used, for example, to create the calendar for the European Union or to create the national calendar for a country, in which regional holidays are celebrated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Belgium <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="fu">list</span>(<span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>), <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">21</span>)))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>France <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="fu">list</span>(<span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>), <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">14</span>)))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>composite_calendar <span class="ot">&lt;-</span> <span class="fu">weighted_calendar</span>(<span class="fu">list</span>(France, Belgium), <span class="at">weights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="generating-regressors" class="level4">
<h4 class="anchored" data-anchor-id="generating-regressors">Generating regressors</h4>
<p>First for monthly, Q, bi monthly…(set this right)</p>
<section id="type-of-days-1" class="level5">
<h5 class="anchored" data-anchor-id="type-of-days-1">Type of days</h5>
<p>This section describes how to generate regressors to correct for type of days effects. They can be based on a default calendar (no specific holidays taken into account) or on a customized calendar.</p>
<section id="trading-day-regressors-without-holidays-using-rjd3toolkittd-function" class="level6">
<h6 class="anchored" data-anchor-id="trading-day-regressors-without-holidays-using-rjd3toolkittd-function">Trading day regressors without holidays using rjd3toolkit::td function</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly regressors for Trading Days: each type of day is different</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># contrasts to Sundays (6 series)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>?td</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>regs_td <span class="ot">&lt;-</span> <span class="fu">td</span>(<span class="at">frequency =</span> <span class="dv">12</span>, <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">1</span>), <span class="dv">60</span>, <span class="at">groups =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">0</span>), <span class="at">contrasts =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>groups</code> argument allows to build groups of days, as daus belonging to the same group will be identified by the same number, and to set a reference for contrasts with the number <code>0</code>.</p>
</section>
<section id="trading-day-regressors-with-pre-defined-holidays-using-rjd3toolkitcalendar_td-function" class="level6">
<h6 class="anchored" data-anchor-id="trading-day-regressors-with-pre-defined-holidays-using-rjd3toolkitcalendar_td-function">Trading day regressors with pre-defined holidays using rjd3toolkit::calendar_td function</h6>
<p>The rjd3toolkit::calendar_td function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>?calendar_td</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># first define a calendar</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>BE <span class="ot">&lt;-</span> <span class="fu">national_calendar</span>(<span class="fu">list</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fixed_day</span>(<span class="dv">7</span>, <span class="dv">21</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"NEWYEAR"</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"CHRISTMAS"</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"MAYDAY"</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"EASTERMONDAY"</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASCENSION"</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"WHITMONDAY"</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ASSUMPTION"</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ALLSAINTSDAY"</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">special_day</span>(<span class="st">"ARMISTICE"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># generate regressors</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">calendar_td</span>(BE,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">frequency =</span> <span class="dv">12</span>, <span class="fu">c</span>(<span class="dv">1980</span>, <span class="dv">1</span>), <span class="dv">240</span>, <span class="at">holiday =</span> <span class="dv">7</span>, <span class="at">groups =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>),</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrasts =</span> <span class="cn">FALSE</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># here three groups and one reference are defined</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Mondays = Tuesdays= Wednesdays (`1`)</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Thursdays= Fridays (`2`)</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Saturdays (`3`)</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Sundays and all holidays (`0`)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="leap-year-1" class="level5">
<h5 class="anchored" data-anchor-id="leap-year-1">Leap year</h5>
</section>
<section id="length-of-period-1" class="level5">
<h5 class="anchored" data-anchor-id="length-of-period-1">Length of Period</h5>
<p>adjust param</p>
</section>
<section id="easter-regressor" class="level5">
<h5 class="anchored" data-anchor-id="easter-regressor">Easter Regressor</h5>
<p>Create a regressor for modelling the easter effect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly regressor, five-year long, duration 8 days, effect finishing on Easter Monday</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ee <span class="ot">&lt;-</span> <span class="fu">easter_variable</span>(<span class="at">frequency =</span> <span class="dv">12</span>, <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">1</span>), <span class="at">length =</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span>, <span class="at">duration =</span> <span class="dv">8</span>, <span class="at">endpos =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Display Easter Sunday dates in given period</p>
<p>The function below allows to display the date of Easter Sunday for each year, in the defined period. Dates are displayed in “YYYY-MM-DD” format and as a number of days since January 1st 1970.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dates from 2018(included) to 2023 (included)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">easter_dates</span>(<span class="dv">2018</span>, <span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stock-td-1" class="level5">
<h5 class="anchored" data-anchor-id="stock-td-1">stock TD</h5>
</section>
<section id="daily-data-dummies" class="level5">
<h5 class="anchored" data-anchor-id="daily-data-dummies">Daily data (dummies)</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## dummies corresponding to holidays</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">holidays</span>(BE, <span class="st">"2020-01-01"</span>, <span class="fl">365.25</span>, <span class="at">type =</span> <span class="st">"All"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="weekly-data" class="level6">
<h6 class="anchored" data-anchor-id="weekly-data">Weekly data</h6>
</section>
</section>
</section>
</section>
</section>
<section id="test-for-residual-calendar-effects" class="level2">
<h2 class="anchored" data-anchor-id="test-for-residual-calendar-effects">Test for Residual Calendar effects</h2>
<p>(To be added: where exactly to find the tests in GUI and R)</p>
<p>We consider below tests on the seasonally adjusted series (<span class="math inline">\(sa_t\)</span>) or on the irregular component (<span class="math inline">\(irr_t\)</span>). When the reasoning applies on both components, we will use <span class="math inline">\(y_t\)</span>. The functions <span class="math inline">\(stdev\)</span> stands for “standard deviation” and <span class="math inline">\(rms\)</span> for “root mean squares”</p>
<p>The tests are computed on the log-transformed components in the case of multiplicative decomposition.</p>
<p>TD are the usual contrasts of trading days, 6 variables (no specific calendar).</p>
<section id="non-significant-irregular" class="level4">
<h4 class="anchored" data-anchor-id="non-significant-irregular">Non significant irregular</h4>
<p>When <span class="math inline">\(irr_t\)</span> is not significant, we don’t compute the test on it, to avoid irrelevant results. We consider that <span class="math inline">\(irr_t\)</span> is significant if <span class="math inline">\(stdev( irr_t)&gt;0.01\)</span> (multiplicative case) or if <span class="math inline">\(stdev(irr_t)/rms(sa_t) &gt;0.01\)</span> (additive case).</p>
</section>
<section id="f-test" class="level4">
<h4 class="anchored" data-anchor-id="f-test">F test</h4>
<p>The test is the usual joint F-test on the TD coefficients, computed on the following models:</p>
<section id="autoregressive-model-ar-modelling-option" class="level5">
<h5 class="anchored" data-anchor-id="autoregressive-model-ar-modelling-option">Autoregressive model (AR modelling option)</h5>
<p>We compute by OLS:</p>
<p><span class="math display">\[
y_t=\mu + \alpha y_{t-1} + \beta TD_t + \epsilon_t
\]</span></p>
</section>
<section id="difference-model" class="level5">
<h5 class="anchored" data-anchor-id="difference-model">Difference model</h5>
<p>We compute by OLS:</p>
<p><span class="math display">\[
\Delta y_t - \overline{\Delta y_t}=\beta TD_t + \epsilon_t
\]</span></p>
<p>So, the latter model is a restriction of the first one (<span class="math inline">\(\alpha =1, \mu =μ=\overline{\Delta y_t}\)</span>)</p>
<p>The tests are the usual joint F-tests on <span class="math inline">\(\beta \quad (H_0:\beta=0)\)</span>.</p>
<p>By default, we compute the tests on the 8 last years of the components, so that they might highlight moving calendar effects.</p>
<p>Remark:</p>
<p>In Tramo, a similar test is computed on the residuals of the ARIMA model. More exactly, the F-test is computed on <span class="math inline">\(e_t=\beta TD_t + \epsilon_t\)</span>, where <span class="math inline">\(e_t\)</span> are the one-step-ahead forecast errors.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./A-outlier-detection.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Outlier detection and external regressors</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./A-benchmarking.html" class="pagination-link">
        <span class="nav-page-text">Benchmarking and temporal disagreggation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right"></div>
  </div>
</footer>



</body></html>